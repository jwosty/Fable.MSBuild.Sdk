<Project>
    <PropertyGroup Condition="'$(TargetFrameworkIdentifier)' == 'Fable'">
        <IntermediateFableFsproj Condition="'$(IntermediateFableFsproj)' == ''">$(BaseIntermediateOutputPath)\$(MSBuildProjectFile)</IntermediateFableFsproj>
        <_FableToolPkgBaseDir Condition="'$(FablePkgBaseDir)' == ''">$(MSBuildThisFileDirectory)..\tools\fable\</_FableToolPkgBaseDir>
        <FableToolDll Condition="'$(FableToolDll)' == ''">$(_FableToolPkgBaseDir)\tools\net6.0\any\fable.dll</FableToolDll>
        <FableCompilerLogFile Condition="'$(EnableFableCompilerLogFile)' == 'true'">$(BaseIntermediateOutputPath)\fable-log.txt</FableCompilerLogFile>
    </PropertyGroup>
    
    <PropertyGroup Condition="'$(TargetFrameworkIdentifier)' == 'Fable'">
        <AssetTargetFallback>$(AssetTargetFallback);netstandard2.1;netstandard2.0;net7.0;net6.0;net5.0</AssetTargetFallback>
    </PropertyGroup>
    
    <PropertyGroup Condition="'$(TargetFrameworkIdentifier)' == 'Fable'">
        <_EnableDefaultWindowsPlatform>false</_EnableDefaultWindowsPlatform>
        <!-- Prevent the .NET SDK from attempting to include mscorlib.dll -->
        <NoStdLib Condition="'$(NoStdLib)' == ''">true</NoStdLib>
    </PropertyGroup>
    
<!--    <ItemGroup Condition="'$(TargetFrameworkIdentifier)' == 'Fable'">-->
<!--        -->
<!--    </ItemGroup>-->
    
    <ItemGroup>
        <!-- Prevent the .NET SDK from trying to copy these -->
        <IntermediateAssembly Remove="@(IntermediateAssembly)" />
    </ItemGroup>
    
    <UsingTask TaskName="Fable.Sdk.Tasks.RedirectFablePackageTargets" AssemblyFile="$(_FableSdkTasksPath)" />
    <UsingTask TaskName="Fable.Sdk.Tasks.GenerateFableFsproj" AssemblyFile="$(_FableSdkTasksPath)" />
    <UsingTask TaskName="Fable.Sdk.Tasks.FableCompile" AssemblyFile="$(_FableSdkTasksPath)" />
    
<!--    <Target Name="_MyCustomTarget" BeforeTargets="_CheckForUnsupportedTargetPlatformIdentifier">-->
<!--        <Message Importance="high" Text="TargetFramework = $(TargetFramework)" />-->
<!--        <Message Importance="high" Text="TargetFrameworkIdentifier = $(TargetFrameworkIdentifier)" />-->
<!--        <Message Importance="high" Text="TargetFrameworkVersion = $(TargetFrameworkVersion)" />-->
<!--        <Message Importance="high" Text="TargetPlatformIdentifier = $(TargetPlatformIdentifier)" />-->
<!--        <Message Importance="high" Text="TargetPlatformVersion = $(TargetPlatformVersion)" />-->
<!--        <Message Importance="high" Text="RuntimeIdentifier = $(RuntimeIdentifier)" />-->
<!--    </Target>-->
    
    <Target
            Name="GenerateIntermediateFableFsproj"
            Inputs="@(CompileBefore);@(Compile);@(CompileAfter)"
            Outputs="$(IntermediateFableFsproj)">
        <GenerateFableFsproj
            Sources="@(CompileBefore);@(Compile);@(CompileAfter)"
            PackageReferences="@(PackageReference)"
            ProjectReferences="@(ProjectReference)"
            OutputFsproj="$(IntermediateFableFsproj)"
        />
    </Target>
    
    <PropertyGroup>
        <CoreCompileDependsOn>$(CoreCompileDependsOn);GenerateIntermediateFableFsproj</CoreCompileDependsOn>
    </PropertyGroup>
    
    <Target Name="CoreCompile" DependsOnTargets="$(CoreCompileDependsOn)">
        <Message Importance="high" Text="Starting Fable compilation..." />
        <FableCompile
                InputFsproj="$(IntermediateFableFsproj)"
                FableToolDll="$(FableToolDll)"
                CompilerLogFile="$(FableCompilerLogFile)" >
            <Output TaskParameter="OutputFiles" PropertyName="FableOutputFiles" />
        </FableCompile>
    </Target>
</Project>